var callStack=new Array();var currentNesting=-1;var currentExceptions=null;var exceptionHandlingSetupDone=false;var exceptionOccured=false;var ignoreException=false;var globalExceptionSettingActive=false;var exceptionHandlingEnabledGlobalSetting=true;var exceptionHandlingScriptLoaded=true;ScriptStart();function SetupExceptionHandling(functionName){ClearCurrentException();if(!CheckScriptLoad()){return"var returnValue; true"}if(!IsExceptionHandlingEnabled()){return"false"}return"var returnInfo = DoExceptionHandling(\""+functionName+"\", arguments);if(returnInfo.returnFromFunction) var returnValue = returnInfo.value;returnInfo.returnFromFunction"}function ClearCurrentException(){exceptionOccured=false;currentExceptions=null}function ErrorFacility(e){return e.number>>16&0x1FFF}function ErrorCode(e){return e.number&0xFFFF}function NewException(errorID,param1,param2){var facility=0;var code=0;var description;if(typeof(appErrorFacility)=="number"&&isFinite(appErrorFacility)){facility=Math.round(appErrorFacility)}if(typeof(appErrorCode)=="number"&&isFinite(appErrorCode)){code=Math.round(appErrorCode)}description=InternalGetAppMessage(errorID,arguments,1,"Unknown exception.");var ex=new Error((facility<<16)+code,description);ex.name=errorID;ex.custom=true;return ex}function GetAppMessage(MessageID,param1,param2){return InternalGetAppMessage(MessageID,arguments,1,"Unknown message.")}function ConvertToString(val){if(typeof(val)=="undefined"){return"undefined"}if(val==null){return"null"}if(typeof(val)=="string"){return val}return val.toString()}function DefaultDisplayException(exceptions,line,url){var str="";for(var i=0;i<exceptions.length;i++){if(i>0){str=str+"-------------------------------------------------------\n"}if(i==exceptions.length-1){str=str+"url = "+url+"\n";str=str+"line = "+line+"\n"}var exceptionEntry=exceptions[i];str=str+FormatExceptionDetails(str,exceptionEntry.exception,exceptionEntry.callStack)}alert(str)}function InitializeErrorHandling(prevOnError){if(IsExceptionHandlingEnabled()){window.onerror=OnWindowError}else{window.onerror=prevOnError}}function IsExceptionHandlingEnabled(){if(globalExceptionSettingActive){return exceptionHandlingEnabledGlobalSetting}return typeof(exceptionHandlingEnabled)!="undefined"&&exceptionHandlingEnabled}function InternalGetAppMessage(messageID,paramValues,startIndex,defaultMessage){var extraValues="";messageID=ConvertToString(messageID);var description;try{description=appMessages[messageID]}catch(e){}if(typeof(description)!="string"){description=messageID+" - "+ConvertToString(defaultMessage)}var regExp;var paramValue;var descWithParam;var paramIndex=paramValues.length-startIndex-1;for(var i=paramValues.length-1;i>=startIndex;i--){regExp=new RegExp("(\\{"+paramIndex.toString()+"\\})","g");paramValue=ConvertToString(paramValues[i]);descWithParam=description.replace(regExp,paramValue);if(descWithParam==description){extraValues=" "+paramValue+extraValues}else{description=descWithParam}paramIndex--}return description+" "+extraValues}function GetCurrentCallStack(){var exceptionCallStack=new Array(currentNesting+1);var index=0;for(var i=currentNesting;i>=0;i--){exceptionCallStack[index++]=callStack[i]}return exceptionCallStack}function HandleException(e){exceptionOccured=true;if(typeof(e.handled)=="undefined"){if(currentExceptions==null){currentExceptions=new Array()}var exceptionEntry=new Object();exceptionEntry.exception=e;exceptionEntry.callStack=GetCurrentCallStack();currentExceptions[currentExceptions.length]=exceptionEntry;e.handled=true}throw e}function OnWindowError(msg,url,line){if(!CheckScriptLoad()){return true}if(ignoreException){ignoreException=false;return true}callStack=new Array();currentNesting=-1;if(currentExceptions==null||currentExceptions.length<1){if(typeof(ReportExternalException)=="function"){ReportExternalException(msg,url,line)}else{alert(msg+"\n"+"url: "+url+"\n"+"Line number: "+(line-1)+"\n"+"Either exception handling is not implemented correctly or the error is from an external script/control")}if(typeof(dialogArguments)!="undefined"){ignoreException=true}return true}for(var i=0;i<currentExceptions.length;i++){var ex=currentExceptions[i].exception;ex.facilityCode=ex.number>>16&0x1FFF;ex.errorCode=ex.number&0xFFFF}var actualLineNo;if(typeof(currentExceptions[currentExceptions.length-1].exception.custom)=="undefined"){actualLineNo=line-1}else{actualLineNo=0}if(typeof(ReportException)=="function"){ReportException(currentExceptions,actualLineNo,url)}else{DefaultDisplayException(currentExceptions,actualLineNo,url)}ClearCurrentException();if(typeof(dialogArguments)!="undefined"){ignoreException=true}return true}function FormatExceptionDetails(str,exception,callStack){str="description = "+exception.description+"\n";str=str+"message = "+exception.message+"\n";str=str+"name = "+exception.name+"\n";str=str+"number = "+exception.number+"\n";str=str+"facility = "+exception.facilityCode+"\n";str=str+"code = "+exception.errorCode+"\n";str=str+"call stack:\n";for(var i=0;i<callStack.length;i++){str=str+"    "+callStack[i]+"\n"}return str}function DoExceptionHandling(functionName,functionArguments){var returnInfo=new Object();if(!IsExceptionHandlingEnabled()){returnInfo.returnFromFunction=false;return returnInfo}if(exceptionHandlingSetupDone){exceptionHandlingSetupDone=false;returnInfo.returnFromFunction=false;return returnInfo}var functionExecStmt;functionExecStmt=functionName+"(";var i;for(i=0;i<functionArguments.length;i++){if(i>0){functionExecStmt=functionExecStmt+","}functionExecStmt=functionExecStmt+"functionArguments["+i.toString()+"]"}functionExecStmt=functionExecStmt+");";exceptionHandlingSetupDone=true;var exceptionCought=false;currentNesting++;callStack[currentNesting]=functionName;try{returnInfo.value=eval(functionExecStmt)}catch(e){exceptionCought=true;HandleException(e)}finally{currentNesting--;if(!exceptionCought&&(exceptionOccured||currentNesting==-1)){ClearCurrentException()}}returnInfo.returnFromFunction=true;return returnInfo}